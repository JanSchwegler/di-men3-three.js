import{ak as Qn,Z as Ye,al as sn,N as $e,R as $n,am as Jn,an as Vn,Q as an,Y as un}from"./three.module-B4QRWreN.js";/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var q=Uint8Array,ye=Uint16Array,jn=Int32Array,hn=new q([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),pn=new q([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),et=new q([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),fn=function(E,S){for(var I=new ye(31),N=0;N<31;++N)I[N]=S+=1<<E[N-1];for(var _=new jn(I[30]),N=1;N<30;++N)for(var d=I[N];d<I[N+1];++d)_[d]=d-I[N]<<5|N;return{b:I,r:_}},vn=fn(hn,2),wn=vn.b,nt=vn.r;wn[28]=258,nt[258]=28;var tt=fn(pn,0),rt=tt.b,je=new ye(32768);for(var M=0;M<32768;++M){var ue=(M&43690)>>1|(M&21845)<<1;ue=(ue&52428)>>2|(ue&13107)<<2,ue=(ue&61680)>>4|(ue&3855)<<4,je[M]=((ue&65280)>>8|(ue&255)<<8)>>1}var Re=function(E,S,I){for(var N=E.length,_=0,d=new ye(S);_<N;++_)E[_]&&++d[E[_]-1];var Z=new ye(S);for(_=1;_<S;++_)Z[_]=Z[_-1]+d[_-1]<<1;var P;if(I){P=new ye(1<<S);var he=15-S;for(_=0;_<N;++_)if(E[_])for(var Ee=_<<4|E[_],re=S-E[_],C=Z[E[_]-1]++<<re,x=C|(1<<re)-1;C<=x;++C)P[je[C]>>he]=Ee}else for(P=new ye(N),_=0;_<N;++_)E[_]&&(P[_]=je[Z[E[_]-1]++]>>15-E[_]);return P},Me=new q(288);for(var M=0;M<144;++M)Me[M]=8;for(var M=144;M<256;++M)Me[M]=9;for(var M=256;M<280;++M)Me[M]=7;for(var M=280;M<288;++M)Me[M]=8;var En=new q(32);for(var M=0;M<32;++M)En[M]=5;var ot=Re(Me,9,1),lt=Re(En,5,1),Je=function(E){for(var S=E[0],I=1;I<E.length;++I)E[I]>S&&(S=E[I]);return S},$=function(E,S,I){var N=S/8|0;return(E[N]|E[N+1]<<8)>>(S&7)&I},Ve=function(E,S){var I=S/8|0;return(E[I]|E[I+1]<<8|E[I+2]<<16)>>(S&7)},it=function(E){return(E+7)/8|0},ct=function(E,S,I){return(I==null||I>E.length)&&(I=E.length),new q(E.subarray(S,I))},st=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],J=function(E,S,I){var N=new Error(S||st[E]);if(N.code=E,Error.captureStackTrace&&Error.captureStackTrace(N,J),!I)throw N;return N},at=function(E,S,I,N){var _=E.length,d=0;if(!_||S.f&&!S.l)return I||new q(0);var Z=!I,P=Z||S.i!=2,he=S.i;Z&&(I=new q(_*3));var Ee=function(Ae){var He=I.length;if(Ae>He){var Te=new q(Math.max(He*2,Ae));Te.set(I),I=Te}},re=S.f||0,C=S.p||0,x=S.b||0,ie=S.l,Ce=S.d,Se=S.m,me=S.n,xe=_*8;do{if(!ie){re=$(E,C,1);var ke=$(E,C+1,3);if(C+=3,ke)if(ke==1)ie=ot,Ce=lt,Se=9,me=5;else if(ke==2){var Ze=$(E,C,31)+257,Ge=$(E,C+10,15)+4,Xe=Ze+$(E,C+5,31)+1;C+=14;for(var pe=new q(Xe),_e=new q(19),B=0;B<Ge;++B)_e[et[B]]=$(E,C+B*3,7);C+=Ge*3;for(var Y=Je(_e),Le=(1<<Y)-1,fe=Re(_e,Y,1),B=0;B<Xe;){var Be=fe[$(E,C,Le)];C+=Be&15;var Q=Be>>4;if(Q<16)pe[B++]=Q;else{var ce=0,ve=0;for(Q==16?(ve=3+$(E,C,3),C+=2,ce=pe[B-1]):Q==17?(ve=3+$(E,C,7),C+=3):Q==18&&(ve=11+$(E,C,127),C+=7);ve--;)pe[B++]=ce}}var Ue=pe.subarray(0,Ze),V=pe.subarray(Ze);Se=Je(Ue),me=Je(V),ie=Re(Ue,Se,1),Ce=Re(V,me,1)}else J(1);else{var Q=it(C)+4,Fe=E[Q-4]|E[Q-3]<<8,De=Q+Fe;if(De>_){he&&J(0);break}P&&Ee(x+Fe),I.set(E.subarray(Q,De),x),S.b=x+=Fe,S.p=C=De*8,S.f=re;continue}if(C>xe){he&&J(0);break}}P&&Ee(x+131072);for(var j=(1<<Se)-1,Ne=(1<<me)-1,W=C;;W=C){var ce=ie[Ve(E,C)&j],ee=ce>>4;if(C+=ce&15,C>xe){he&&J(0);break}if(ce||J(2),ee<256)I[x++]=ee;else if(ee==256){W=C,ie=null;break}else{var ge=ee-254;if(ee>264){var B=ee-257,se=hn[B];ge=$(E,C,(1<<se)-1)+wn[B],C+=se}var T=Ce[Ve(E,C)&Ne],ne=T>>4;T||J(3),C+=T&15;var V=rt[ne];if(ne>3){var se=pn[ne];V+=Ve(E,C)&(1<<se)-1,C+=se}if(C>xe){he&&J(0);break}P&&Ee(x+131072);var oe=x+ge;if(x<V){var Pe=d-V,Ke=Math.min(V,oe);for(Pe+x<0&&J(3);x<Ke;++x)I[x]=N[Pe+x]}for(;x<oe;++x)I[x]=I[x-V]}}S.l=ie,S.p=W,S.b=x,S.f=re,ie&&(re=1,S.m=Se,S.d=Ce,S.n=me)}while(!re);return x!=I.length&&Z?ct(I,0,x):I.subarray(0,x)},ut=new q(0),ht=function(E,S){return((E[0]&15)!=8||E[0]>>4>7||(E[0]<<8|E[1])%31)&&J(6,"invalid zlib data"),(E[1]>>5&1)==+!S&&J(6,"invalid zlib data: "+(E[1]&32?"need":"unexpected")+" dictionary"),(E[1]>>3&4)+2};function We(E,S){return at(E.subarray(ht(E,S),-4),{i:2},S,S)}var pt=typeof TextDecoder<"u"&&new TextDecoder,ft=0;try{pt.decode(ut,{stream:!0}),ft=1}catch{}class wt extends Qn{constructor(S){super(S),this.type=Ye}parse(S){const pe=Math.pow(2.7182818,2.2);function _e(e,n){let t=0;for(let l=0;l<65536;++l)(l==0||e[l>>3]&1<<(l&7))&&(n[t++]=l);const r=t-1;for(;t<65536;)n[t++]=0;return r}function B(e){for(let n=0;n<16384;n++)e[n]={},e[n].len=0,e[n].lit=0,e[n].p=null}const Y={l:0,c:0,lc:0};function Le(e,n,t,r,l){for(;t<e;)n=n<<8|rn(r,l),t+=8;t-=e,Y.l=n>>t&(1<<e)-1,Y.c=n,Y.lc=t}const fe=new Array(59);function Be(e){for(let t=0;t<=58;++t)fe[t]=0;for(let t=0;t<65537;++t)fe[e[t]]+=1;let n=0;for(let t=58;t>0;--t){const r=n+fe[t]>>1;fe[t]=n,n=r}for(let t=0;t<65537;++t){const r=e[t];r>0&&(e[t]=r|fe[r]++<<6)}}function ce(e,n,t,r,l,o){const s=n;let u=0,a=0;for(;r<=l;r++){if(s.value-n.value>t)return!1;Le(6,u,a,e,s);const c=Y.l;if(u=Y.c,a=Y.lc,o[r]=c,c==63){if(s.value-n.value>t)throw new Error("Something wrong with hufUnpackEncTable");Le(8,u,a,e,s);let i=Y.l+6;if(u=Y.c,a=Y.lc,r+i>l+1)throw new Error("Something wrong with hufUnpackEncTable");for(;i--;)o[r++]=0;r--}else if(c>=59){let i=c-59+2;if(r+i>l+1)throw new Error("Something wrong with hufUnpackEncTable");for(;i--;)o[r++]=0;r--}}Be(o)}function ve(e){return e&63}function Ue(e){return e>>6}function V(e,n,t,r){for(;n<=t;n++){const l=Ue(e[n]),o=ve(e[n]);if(l>>o)throw new Error("Invalid table entry");if(o>14){const s=r[l>>o-14];if(s.len)throw new Error("Invalid table entry");if(s.lit++,s.p){const u=s.p;s.p=new Array(s.lit);for(let a=0;a<s.lit-1;++a)s.p[a]=u[a]}else s.p=new Array(1);s.p[s.lit-1]=n}else if(o){let s=0;for(let u=1<<14-o;u>0;u--){const a=r[(l<<14-o)+s];if(a.len||a.p)throw new Error("Invalid table entry");a.len=o,a.lit=n,s++}}}return!0}const j={c:0,lc:0};function Ne(e,n,t,r){e=e<<8|rn(t,r),n+=8,j.c=e,j.lc=n}const W={c:0,lc:0};function ee(e,n,t,r,l,o,s,u,a){if(e==n){r<8&&(Ne(t,r,l,o),t=j.c,r=j.lc),r-=8;let c=t>>r;if(c=new Uint8Array([c])[0],u.value+c>a)return!1;const i=s[u.value-1];for(;c-- >0;)s[u.value++]=i}else if(u.value<a)s[u.value++]=e;else return!1;W.c=t,W.lc=r}function ge(e){return e&65535}function se(e){const n=ge(e);return n>32767?n-65536:n}const T={a:0,b:0};function ne(e,n){const t=se(e),l=se(n),o=t+(l&1)+(l>>1),s=o,u=o-l;T.a=s,T.b=u}function oe(e,n){const t=ge(e),r=ge(n),l=t-(r>>1)&65535,o=r+l-32768&65535;T.a=o,T.b=l}function Pe(e,n,t,r,l,o,s){const u=s<16384,a=t>l?l:t;let c=1,i,h;for(;c<=a;)c<<=1;for(c>>=1,i=c,c>>=1;c>=1;){h=0;const w=h+o*(l-i),p=o*c,g=o*i,f=r*c,m=r*i;let y,b,k,z;for(;h<=w;h+=g){let R=h;const U=h+r*(t-i);for(;R<=U;R+=m){const F=R+f,K=R+p,D=K+f;u?(ne(e[R+n],e[K+n]),y=T.a,k=T.b,ne(e[F+n],e[D+n]),b=T.a,z=T.b,ne(y,b),e[R+n]=T.a,e[F+n]=T.b,ne(k,z),e[K+n]=T.a,e[D+n]=T.b):(oe(e[R+n],e[K+n]),y=T.a,k=T.b,oe(e[F+n],e[D+n]),b=T.a,z=T.b,oe(y,b),e[R+n]=T.a,e[F+n]=T.b,oe(k,z),e[K+n]=T.a,e[D+n]=T.b)}if(t&c){const F=R+p;u?ne(e[R+n],e[F+n]):oe(e[R+n],e[F+n]),y=T.a,e[F+n]=T.b,e[R+n]=y}}if(l&c){let R=h;const U=h+r*(t-i);for(;R<=U;R+=m){const F=R+f;u?ne(e[R+n],e[F+n]):oe(e[R+n],e[F+n]),y=T.a,e[F+n]=T.b,e[R+n]=y}}i=c,c>>=1}return h}function Ke(e,n,t,r,l,o,s,u,a){let c=0,i=0;const h=s,w=Math.trunc(r.value+(l+7)/8);for(;r.value<w;)for(Ne(c,i,t,r),c=j.c,i=j.lc;i>=14;){const g=c>>i-14&16383,f=n[g];if(f.len)i-=f.len,ee(f.lit,o,c,i,t,r,u,a,h),c=W.c,i=W.lc;else{if(!f.p)throw new Error("hufDecode issues");let m;for(m=0;m<f.lit;m++){const y=ve(e[f.p[m]]);for(;i<y&&r.value<w;)Ne(c,i,t,r),c=j.c,i=j.lc;if(i>=y&&Ue(e[f.p[m]])==(c>>i-y&(1<<y)-1)){i-=y,ee(f.p[m],o,c,i,t,r,u,a,h),c=W.c,i=W.lc;break}}if(m==f.lit)throw new Error("hufDecode issues")}}const p=8-l&7;for(c>>=p,i-=p;i>0;){const g=n[c<<14-i&16383];if(g.len)i-=g.len,ee(g.lit,o,c,i,t,r,u,a,h),c=W.c,i=W.lc;else throw new Error("hufDecode issues")}return!0}function Ae(e,n,t,r,l,o){const s={value:0},u=t.value,a=X(n,t),c=X(n,t);t.value+=4;const i=X(n,t);if(t.value+=4,a<0||a>=65537||c<0||c>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const h=new Array(65537),w=new Array(16384);B(w);const p=r-(t.value-u);if(ce(e,t,p,a,c,h),i>8*(r-(t.value-u)))throw new Error("Something wrong with hufUncompress");V(h,a,c,w),Ke(h,w,e,t,i,c,o,l,s)}function He(e,n,t){for(let r=0;r<t;++r)n[r]=e[n[r]]}function Te(e){for(let n=1;n<e.length;n++){const t=e[n-1]+e[n]-128;e[n]=t}}function en(e,n){let t=0,r=Math.floor((e.length+1)/2),l=0;const o=e.length-1;for(;!(l>o||(n[l++]=e[t++],l>o));)n[l++]=e[r++]}function nn(e){let n=e.byteLength;const t=new Array;let r=0;const l=new DataView(e);for(;n>0;){const o=l.getInt8(r++);if(o<0){const s=-o;n-=s+1;for(let u=0;u<s;u++)t.push(l.getUint8(r++))}else{const s=o;n-=2;const u=l.getUint8(r++);for(let a=0;a<s+1;a++)t.push(u)}}return t}function Sn(e,n,t,r,l,o){let s=new DataView(o.buffer);const u=t[e.idx[0]].width,a=t[e.idx[0]].height,c=3,i=Math.floor(u/8),h=Math.ceil(u/8),w=Math.ceil(a/8),p=u-(h-1)*8,g=a-(w-1)*8,f={value:0},m=new Array(c),y=new Array(c),b=new Array(c),k=new Array(c),z=new Array(c);for(let U=0;U<c;++U)z[U]=n[e.idx[U]],m[U]=U<1?0:m[U-1]+h*w,y[U]=new Float32Array(64),b[U]=new Uint16Array(64),k[U]=new Uint16Array(h*64);for(let U=0;U<w;++U){let F=8;U==w-1&&(F=g);let K=8;for(let A=0;A<h;++A){A==h-1&&(K=p);for(let O=0;O<c;++O)b[O].fill(0),b[O][0]=l[m[O]++],mn(f,r,b[O]),gn(b[O],y[O]),In(y[O]);yn(y);for(let O=0;O<c;++O)Cn(y[O],k[O],A*64)}let D=0;for(let A=0;A<c;++A){const O=t[e.idx[A]].type;for(let le=8*U;le<8*U+F;++le){D=z[A][le];for(let Oe=0;Oe<i;++Oe){const te=Oe*64+(le&7)*8;s.setUint16(D+0*2*O,k[A][te+0],!0),s.setUint16(D+1*2*O,k[A][te+1],!0),s.setUint16(D+2*2*O,k[A][te+2],!0),s.setUint16(D+3*2*O,k[A][te+3],!0),s.setUint16(D+4*2*O,k[A][te+4],!0),s.setUint16(D+5*2*O,k[A][te+5],!0),s.setUint16(D+6*2*O,k[A][te+6],!0),s.setUint16(D+7*2*O,k[A][te+7],!0),D+=8*2*O}}if(i!=h)for(let le=8*U;le<8*U+F;++le){const Oe=z[A][le]+8*i*2*O,te=i*64+(le&7)*8;for(let de=0;de<K;++de)s.setUint16(Oe+de*2*O,k[A][te+de],!0)}}}const R=new Uint16Array(u);s=new DataView(o.buffer);for(let U=0;U<c;++U){t[e.idx[U]].decoded=!0;const F=t[e.idx[U]].type;if(t[U].type==2)for(let K=0;K<a;++K){const D=z[U][K];for(let A=0;A<u;++A)R[A]=s.getUint16(D+A*2*F,!0);for(let A=0;A<u;++A)s.setFloat32(D+A*2*F,v(R[A]),!0)}}}function mn(e,n,t){let r,l=1;for(;l<64;)r=n[e.value],r==65280?l=64:r>>8==255?l+=r&255:(t[l]=r,l++),e.value++}function gn(e,n){n[0]=v(e[0]),n[1]=v(e[1]),n[2]=v(e[5]),n[3]=v(e[6]),n[4]=v(e[14]),n[5]=v(e[15]),n[6]=v(e[27]),n[7]=v(e[28]),n[8]=v(e[2]),n[9]=v(e[4]),n[10]=v(e[7]),n[11]=v(e[13]),n[12]=v(e[16]),n[13]=v(e[26]),n[14]=v(e[29]),n[15]=v(e[42]),n[16]=v(e[3]),n[17]=v(e[8]),n[18]=v(e[12]),n[19]=v(e[17]),n[20]=v(e[25]),n[21]=v(e[30]),n[22]=v(e[41]),n[23]=v(e[43]),n[24]=v(e[9]),n[25]=v(e[11]),n[26]=v(e[18]),n[27]=v(e[24]),n[28]=v(e[31]),n[29]=v(e[40]),n[30]=v(e[44]),n[31]=v(e[53]),n[32]=v(e[10]),n[33]=v(e[19]),n[34]=v(e[23]),n[35]=v(e[32]),n[36]=v(e[39]),n[37]=v(e[45]),n[38]=v(e[52]),n[39]=v(e[54]),n[40]=v(e[20]),n[41]=v(e[22]),n[42]=v(e[33]),n[43]=v(e[38]),n[44]=v(e[46]),n[45]=v(e[51]),n[46]=v(e[55]),n[47]=v(e[60]),n[48]=v(e[21]),n[49]=v(e[34]),n[50]=v(e[37]),n[51]=v(e[47]),n[52]=v(e[50]),n[53]=v(e[56]),n[54]=v(e[59]),n[55]=v(e[61]),n[56]=v(e[35]),n[57]=v(e[36]),n[58]=v(e[48]),n[59]=v(e[49]),n[60]=v(e[57]),n[61]=v(e[58]),n[62]=v(e[62]),n[63]=v(e[63])}function In(e){const n=.5*Math.cos(.7853975),t=.5*Math.cos(3.14159/16),r=.5*Math.cos(3.14159/8),l=.5*Math.cos(3*3.14159/16),o=.5*Math.cos(5*3.14159/16),s=.5*Math.cos(3*3.14159/8),u=.5*Math.cos(7*3.14159/16),a=new Array(4),c=new Array(4),i=new Array(4),h=new Array(4);for(let w=0;w<8;++w){const p=w*8;a[0]=r*e[p+2],a[1]=s*e[p+2],a[2]=r*e[p+6],a[3]=s*e[p+6],c[0]=t*e[p+1]+l*e[p+3]+o*e[p+5]+u*e[p+7],c[1]=l*e[p+1]-u*e[p+3]-t*e[p+5]-o*e[p+7],c[2]=o*e[p+1]-t*e[p+3]+u*e[p+5]+l*e[p+7],c[3]=u*e[p+1]-o*e[p+3]+l*e[p+5]-t*e[p+7],i[0]=n*(e[p+0]+e[p+4]),i[3]=n*(e[p+0]-e[p+4]),i[1]=a[0]+a[3],i[2]=a[1]-a[2],h[0]=i[0]+i[1],h[1]=i[3]+i[2],h[2]=i[3]-i[2],h[3]=i[0]-i[1],e[p+0]=h[0]+c[0],e[p+1]=h[1]+c[1],e[p+2]=h[2]+c[2],e[p+3]=h[3]+c[3],e[p+4]=h[3]-c[3],e[p+5]=h[2]-c[2],e[p+6]=h[1]-c[1],e[p+7]=h[0]-c[0]}for(let w=0;w<8;++w)a[0]=r*e[16+w],a[1]=s*e[16+w],a[2]=r*e[48+w],a[3]=s*e[48+w],c[0]=t*e[8+w]+l*e[24+w]+o*e[40+w]+u*e[56+w],c[1]=l*e[8+w]-u*e[24+w]-t*e[40+w]-o*e[56+w],c[2]=o*e[8+w]-t*e[24+w]+u*e[40+w]+l*e[56+w],c[3]=u*e[8+w]-o*e[24+w]+l*e[40+w]-t*e[56+w],i[0]=n*(e[w]+e[32+w]),i[3]=n*(e[w]-e[32+w]),i[1]=a[0]+a[3],i[2]=a[1]-a[2],h[0]=i[0]+i[1],h[1]=i[3]+i[2],h[2]=i[3]-i[2],h[3]=i[0]-i[1],e[0+w]=h[0]+c[0],e[8+w]=h[1]+c[1],e[16+w]=h[2]+c[2],e[24+w]=h[3]+c[3],e[32+w]=h[3]-c[3],e[40+w]=h[2]-c[2],e[48+w]=h[1]-c[1],e[56+w]=h[0]-c[0]}function yn(e){for(let n=0;n<64;++n){const t=e[0][n],r=e[1][n],l=e[2][n];e[0][n]=t+1.5747*l,e[1][n]=t-.1873*r-.4682*l,e[2][n]=t+1.8556*r}}function Cn(e,n,t){for(let r=0;r<64;++r)n[t+r]=un.toHalfFloat(_n(e[r]))}function _n(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(pe,Math.abs(e)-1)}function qe(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function Un(e){const n=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),t=new Uint8Array(nn(n)),r=new Uint8Array(t.length);return Te(t),en(t,r),new DataView(r.buffer)}function Qe(e){const n=e.array.slice(e.offset.value,e.offset.value+e.size),t=We(n),r=new Uint8Array(t.length);return Te(t),en(t,r),new DataView(r.buffer)}function Nn(e){const n=e.viewer,t={value:e.offset.value},r=new Uint16Array(e.columns*e.lines*(e.inputChannels.length*e.type)),l=new Uint8Array(8192);let o=0;const s=new Array(e.inputChannels.length);for(let g=0,f=e.inputChannels.length;g<f;g++)s[g]={},s[g].start=o,s[g].end=s[g].start,s[g].nx=e.columns,s[g].ny=e.lines,s[g].size=e.type,o+=s[g].nx*s[g].ny*s[g].size;const u=be(n,t),a=be(n,t);if(a>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(u<=a)for(let g=0;g<a-u+1;g++)l[g+u]=ae(n,t);const c=new Uint16Array(65536),i=_e(l,c),h=X(n,t);Ae(e.array,n,t,h,r,o);for(let g=0;g<e.inputChannels.length;++g){const f=s[g];for(let m=0;m<s[g].size;++m)Pe(r,f.start+m,f.nx,f.size,f.ny,f.nx*f.size,i)}He(c,r,o);let w=0;const p=new Uint8Array(r.buffer.byteLength);for(let g=0;g<e.lines;g++)for(let f=0;f<e.inputChannels.length;f++){const m=s[f],y=m.nx*m.size,b=new Uint8Array(r.buffer,m.end*2,y*2);p.set(b,w),w+=y*2,m.end+=y}return new DataView(p.buffer)}function An(e){const n=e.array.slice(e.offset.value,e.offset.value+e.size),t=We(n),r=e.inputChannels.length*e.lines*e.columns*e.totalBytes,l=new ArrayBuffer(r),o=new DataView(l);let s=0,u=0;const a=new Array(4);for(let c=0;c<e.lines;c++)for(let i=0;i<e.inputChannels.length;i++){let h=0;switch(e.inputChannels[i].pixelType){case 1:a[0]=s,a[1]=a[0]+e.columns,s=a[1]+e.columns;for(let p=0;p<e.columns;++p){const g=t[a[0]++]<<8|t[a[1]++];h+=g,o.setUint16(u,h,!0),u+=2}break;case 2:a[0]=s,a[1]=a[0]+e.columns,a[2]=a[1]+e.columns,s=a[2]+e.columns;for(let p=0;p<e.columns;++p){const g=t[a[0]++]<<24|t[a[1]++]<<16|t[a[2]++]<<8;h+=g,o.setUint32(u,h,!0),u+=4}break}}return o}function tn(e){const n=e.viewer,t={value:e.offset.value},r=new Uint8Array(e.columns*e.lines*(e.inputChannels.length*e.type*2)),l={version:H(n,t),unknownUncompressedSize:H(n,t),unknownCompressedSize:H(n,t),acCompressedSize:H(n,t),dcCompressedSize:H(n,t),rleCompressedSize:H(n,t),rleUncompressedSize:H(n,t),rleRawSize:H(n,t),totalAcUncompressedCount:H(n,t),totalDcUncompressedCount:H(n,t),acCompression:H(n,t)};if(l.version<2)throw new Error("EXRLoader.parse: "+we.compression+" version "+l.version+" is unsupported");const o=new Array;let s=be(n,t)-2;for(;s>0;){const f=ze(n.buffer,t),m=ae(n,t),y=m>>2&3,b=(m>>4)-1,k=new Int8Array([b])[0],z=ae(n,t);o.push({name:f,index:k,type:z,compression:y}),s-=f.length+3}const u=we.channels,a=new Array(e.inputChannels.length);for(let f=0;f<e.inputChannels.length;++f){const m=a[f]={},y=u[f];m.name=y.name,m.compression=0,m.decoded=!1,m.type=y.pixelType,m.pLinear=y.pLinear,m.width=e.columns,m.height=e.lines}const c={idx:new Array(3)};for(let f=0;f<e.inputChannels.length;++f){const m=a[f];for(let y=0;y<o.length;++y){const b=o[y];m.name==b.name&&(m.compression=b.compression,b.index>=0&&(c.idx[b.index]=f),m.offset=f)}}let i,h,w;if(l.acCompressedSize>0)switch(l.acCompression){case 0:i=new Uint16Array(l.totalAcUncompressedCount),Ae(e.array,n,t,l.acCompressedSize,i,l.totalAcUncompressedCount);break;case 1:const f=e.array.slice(t.value,t.value+l.totalAcUncompressedCount),m=We(f);i=new Uint16Array(m.buffer),t.value+=l.totalAcUncompressedCount;break}if(l.dcCompressedSize>0){const f={array:e.array,offset:t,size:l.dcCompressedSize};h=new Uint16Array(Qe(f).buffer),t.value+=l.dcCompressedSize}if(l.rleRawSize>0){const f=e.array.slice(t.value,t.value+l.rleCompressedSize),m=We(f);w=nn(m.buffer),t.value+=l.rleCompressedSize}let p=0;const g=new Array(a.length);for(let f=0;f<g.length;++f)g[f]=new Array;for(let f=0;f<e.lines;++f)for(let m=0;m<a.length;++m)g[m].push(p),p+=a[m].width*e.type*2;Sn(c,g,a,i,h,r);for(let f=0;f<a.length;++f){const m=a[f];if(!m.decoded)switch(m.compression){case 2:let y=0,b=0;for(let k=0;k<e.lines;++k){let z=g[f][y];for(let R=0;R<m.width;++R){for(let U=0;U<2*m.type;++U)r[z++]=w[b+U*m.width*m.height];b++}y++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(r.buffer)}function ze(e,n){const t=new Uint8Array(e);let r=0;for(;t[n.value+r]!=0;)r+=1;const l=new TextDecoder().decode(t.slice(n.value,n.value+r));return n.value=n.value+r+1,l}function Tn(e,n,t){const r=new TextDecoder().decode(new Uint8Array(e).slice(n.value,n.value+t));return n.value=n.value+t,r}function bn(e,n){const t=G(e,n),r=X(e,n);return[t,r]}function On(e,n){const t=X(e,n),r=X(e,n);return[t,r]}function G(e,n){const t=e.getInt32(n.value,!0);return n.value=n.value+4,t}function X(e,n){const t=e.getUint32(n.value,!0);return n.value=n.value+4,t}function rn(e,n){const t=e[n.value];return n.value=n.value+1,t}function ae(e,n){const t=e.getUint8(n.value);return n.value=n.value+1,t}const H=function(e,n){let t;return"getBigInt64"in DataView.prototype?t=Number(e.getBigInt64(n.value,!0)):t=e.getUint32(n.value+4,!0)+Number(e.getUint32(n.value,!0)<<32),n.value+=8,t};function L(e,n){const t=e.getFloat32(n.value,!0);return n.value+=4,t}function Rn(e,n){return un.toHalfFloat(L(e,n))}function v(e){const n=(e&31744)>>10,t=e&1023;return(e>>15?-1:1)*(n?n===31?t?NaN:1/0:Math.pow(2,n-15)*(1+t/1024):6103515625e-14*(t/1024))}function be(e,n){const t=e.getUint16(n.value,!0);return n.value+=2,t}function Mn(e,n){return v(be(e,n))}function xn(e,n,t,r){const l=t.value,o=[];for(;t.value<l+r-1;){const s=ze(n,t),u=G(e,t),a=ae(e,t);t.value+=3;const c=G(e,t),i=G(e,t);o.push({name:s,pixelType:u,pLinear:a,xSampling:c,ySampling:i})}return t.value+=1,o}function kn(e,n){const t=L(e,n),r=L(e,n),l=L(e,n),o=L(e,n),s=L(e,n),u=L(e,n),a=L(e,n),c=L(e,n);return{redX:t,redY:r,greenX:l,greenY:o,blueX:s,blueY:u,whiteX:a,whiteY:c}}function Fn(e,n){const t=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],r=ae(e,n);return t[r]}function Dn(e,n){const t=G(e,n),r=G(e,n),l=G(e,n),o=G(e,n);return{xMin:t,yMin:r,xMax:l,yMax:o}}function Zn(e,n){const t=["INCREASING_Y","DECREASING_Y","RANDOM_Y"],r=ae(e,n);return t[r]}function Ln(e,n){const t=["ENVMAP_LATLONG","ENVMAP_CUBE"],r=ae(e,n);return t[r]}function Bn(e,n){const t=["ONE_LEVEL","MIPMAP_LEVELS","RIPMAP_LEVELS"],r=["ROUND_DOWN","ROUND_UP"],l=X(e,n),o=X(e,n),s=ae(e,n);return{xSize:l,ySize:o,levelMode:t[s&15],roundingMode:r[s>>4]}}function Pn(e,n){const t=L(e,n),r=L(e,n);return[t,r]}function Hn(e,n){const t=L(e,n),r=L(e,n),l=L(e,n);return[t,r,l]}function zn(e,n,t,r,l){if(r==="string"||r==="stringvector"||r==="iccProfile")return Tn(n,t,l);if(r==="chlist")return xn(e,n,t,l);if(r==="chromaticities")return kn(e,t);if(r==="compression")return Fn(e,t);if(r==="box2i")return Dn(e,t);if(r==="envmap")return Ln(e,t);if(r==="tiledesc")return Bn(e,t);if(r==="lineOrder")return Zn(e,t);if(r==="float")return L(e,t);if(r==="v2f")return Pn(e,t);if(r==="v3f")return Hn(e,t);if(r==="int")return G(e,t);if(r==="rational")return bn(e,t);if(r==="timecode")return On(e,t);if(r==="preview")return t.value+=l,"skipped";t.value+=l}function dn(e,n){const t=Math.log2(e);return n=="ROUND_DOWN"?Math.floor(t):Math.ceil(t)}function Yn(e,n,t){let r=0;switch(e.levelMode){case"ONE_LEVEL":r=1;break;case"MIPMAP_LEVELS":r=dn(Math.max(n,t),e.roundingMode)+1;break;case"RIPMAP_LEVELS":throw new Error("THREE.EXRLoader: RIPMAP_LEVELS tiles currently unsupported.")}return r}function on(e,n,t,r){const l=new Array(e);for(let o=0;o<e;o++){const s=1<<o;let u=n/s|0;r=="ROUND_UP"&&u*s<n&&(u+=1);const a=Math.max(u,1);l[o]=(a+t-1)/t|0}return l}function Wn(){const e=this,n=e.offset,t={value:0};for(let r=0;r<e.tileCount;r++){const l=G(e.viewer,n),o=G(e.viewer,n);n.value+=8,e.size=X(e.viewer,n);const s=l*e.blockWidth,u=o*e.blockHeight;e.columns=s+e.blockWidth>e.width?e.width-s:e.blockWidth,e.lines=u+e.blockHeight>e.height?e.height-u:e.blockHeight;const a=e.columns*e.totalBytes,i=e.size<e.lines*a?e.uncompress(e):qe(e);n.value+=e.size;for(let h=0;h<e.lines;h++){const w=h*e.columns*e.totalBytes;for(let p=0;p<e.inputChannels.length;p++){const g=we.channels[p].name,f=e.channelByteOffsets[g]*e.columns,m=e.decodeChannels[g];if(m===void 0)continue;t.value=w+f;const y=(e.height-(1+u+h))*e.outLineWidth;for(let b=0;b<e.columns;b++){const k=y+(b+s)*e.outputChannels+m;e.byteArray[k]=e.getter(i,t)}}}}}function Gn(){const e=this,n=e.offset,t={value:0};for(let r=0;r<e.height/e.blockHeight;r++){const l=G(e.viewer,n)-we.dataWindow.yMin;e.size=X(e.viewer,n),e.lines=l+e.blockHeight>e.height?e.height-l:e.blockHeight;const o=e.columns*e.totalBytes,u=e.size<e.lines*o?e.uncompress(e):qe(e);n.value+=e.size;for(let a=0;a<e.blockHeight;a++){const c=r*e.blockHeight,i=a+e.scanOrder(c);if(i>=e.height)continue;const h=a*o,w=(e.height-1-i)*e.outLineWidth;for(let p=0;p<e.inputChannels.length;p++){const g=we.channels[p].name,f=e.channelByteOffsets[g]*e.columns,m=e.decodeChannels[g];if(m!==void 0){t.value=h+f;for(let y=0;y<e.columns;y++){const b=w+y*e.outputChannels+m;e.byteArray[b]=e.getter(u,t)}}}}}}function Xn(e,n,t){const r={};if(e.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");r.version=e.getUint8(4);const l=e.getUint8(5);r.spec={singleTile:!!(l&2),longName:!!(l&4),deepFormat:!!(l&8),multiPart:!!(l&16)},t.value=8;let o=!0;for(;o;){const s=ze(n,t);if(s==0)o=!1;else{const u=ze(n,t),a=X(e,t),c=zn(e,n,t,u,a);c===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${u}'.`):r[s]=c}}if(l&-7)throw console.error("THREE.EXRHeader:",r),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return r}function Kn(e,n,t,r,l){const o={size:0,viewer:n,array:t,offset:r,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,inputChannels:e.channels,channelByteOffsets:{},scanOrder:null,totalBytes:null,columns:null,lines:null,type:null,uncompress:null,getter:null,format:null,colorSpace:sn};switch(e.compression){case"NO_COMPRESSION":o.blockHeight=1,o.uncompress=qe;break;case"RLE_COMPRESSION":o.blockHeight=1,o.uncompress=Un;break;case"ZIPS_COMPRESSION":o.blockHeight=1,o.uncompress=Qe;break;case"ZIP_COMPRESSION":o.blockHeight=16,o.uncompress=Qe;break;case"PIZ_COMPRESSION":o.blockHeight=32,o.uncompress=Nn;break;case"PXR24_COMPRESSION":o.blockHeight=16,o.uncompress=An;break;case"DWAA_COMPRESSION":o.blockHeight=32,o.uncompress=tn;break;case"DWAB_COMPRESSION":o.blockHeight=256,o.uncompress=tn;break;default:throw new Error("EXRLoader.parse: "+e.compression+" is unsupported")}const s={};for(const i of e.channels)switch(i.name){case"Y":case"R":case"G":case"B":case"A":s[i.name]=!0,o.type=i.pixelType}let u=!1;if(s.R&&s.G&&s.B)u=!s.A,o.outputChannels=4,o.decodeChannels={R:0,G:1,B:2,A:3};else if(s.Y)o.outputChannels=1,o.decodeChannels={Y:0};else throw new Error("EXRLoader.parse: file contains unsupported data channels.");if(o.type==1)switch(l){case $e:o.getter=Mn;break;case Ye:o.getter=be;break}else if(o.type==2)switch(l){case $e:o.getter=L;break;case Ye:o.getter=Rn}else throw new Error("EXRLoader.parse: unsupported pixelType "+o.type+" for "+e.compression+".");o.columns=o.width;const a=o.width*o.height*o.outputChannels;switch(l){case $e:o.byteArray=new Float32Array(a),u&&o.byteArray.fill(1,0,a);break;case Ye:o.byteArray=new Uint16Array(a),u&&o.byteArray.fill(15360,0,a);break;default:console.error("THREE.EXRLoader: unsupported type: ",l);break}let c=0;for(const i of e.channels)o.decodeChannels[i.name]!==void 0&&(o.channelByteOffsets[i.name]=c),c+=i.pixelType*2;if(o.totalBytes=c,o.outLineWidth=o.width*o.outputChannels,e.lineOrder==="INCREASING_Y"?o.scanOrder=i=>i:o.scanOrder=i=>o.height-1-i,o.outputChannels==4?(o.format=$n,o.colorSpace=sn):(o.format=Jn,o.colorSpace=Vn),e.spec.singleTile){o.blockHeight=e.tiles.ySize,o.blockWidth=e.tiles.xSize;const i=Yn(e.tiles,o.width,o.height),h=on(i,o.width,e.tiles.xSize,e.tiles.roundingMode),w=on(i,o.height,e.tiles.ySize,e.tiles.roundingMode);o.tileCount=h[0]*w[0];for(let p=0;p<i;p++)for(let g=0;g<w[p];g++)for(let f=0;f<h[p];f++)H(n,r);o.decode=Wn.bind(o)}else{o.blockWidth=o.width;const i=Math.ceil(o.height/o.blockHeight);for(let h=0;h<i;h++)H(n,r);o.decode=Gn.bind(o)}return o}const ln={value:0},cn=new DataView(S),qn=new Uint8Array(S),we=Xn(cn,S,ln),Ie=Kn(we,cn,qn,ln,this.type);return Ie.decode(),{header:we,width:Ie.width,height:Ie.height,data:Ie.byteArray,format:Ie.format,colorSpace:Ie.colorSpace,type:this.type}}setDataType(S){return this.type=S,this}load(S,I,N,_){function d(Z,P){Z.colorSpace=P.colorSpace,Z.minFilter=an,Z.magFilter=an,Z.generateMipmaps=!1,Z.flipY=!1,I&&I(Z,P)}return super.load(S,d,N,_)}}export{wt as E};
